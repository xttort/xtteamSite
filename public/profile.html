<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <title>–ü—Ä–æ—Ñ–∏–ª—å - xtteam</title>
    <link rel="icon" href="./images/icons/icon.svg">
    <style>
        .achievement-icon {
            background-color: #6C5CE7;
            color: white;
            border-radius: 12px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .achievement-icon.locked {
            background-color: #f1f2f6;
            color: #b2bec3;
            filter: grayscale(100%);
        }
        
        .achievement-icon.unlocked {
            background-color: #6C5CE7;
            color: white;
        }
    </style>
</head>
<body>
    <header class="header">
        <a class="logo" href="./index.html"><img class="logo" src="./images/icons/icon.svg" alt="logo"> <h1 href="#!">xtteam</h1></a>
        <ul class="header_list">
            <li><a class="header_purple" href="./index.html">Latest news</a></li>
            <li><a class="dot">‚Ä¢</a></li>
            <li><a class="header_purple" href="./games/games.html">Games</a></li>
            <li><a class="dot">‚Ä¢</a></li>
            <li><a class="header_purple" href="./aboutUs/aboutUs.html">About us</a></li>
        </ul>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="auth-container">
            <div id="profileButton" class="profile-info">
                <a href="/profile" class="profile-link">
                    <div class="profile-avatar" id="profileAvatar">U</div>
                    <span class="profile-name" id="profileName">User</span>
                </a>
            </div>
        </div>
    </header>
    
    <div class="rectbg profile-page">
        <div class="container">
            <div class="profile-header">
                <h1 class="profile-welcome">Welcome</h1>
                <div class="profile-username" id="profileUsername">Loading...</div>
            </div>
            
            <div class="profile-stats">
                <div class="stat-card">
                    <div class="stat-value" id="achievementsCount">0</div>
                    <div class="stat-label">Achievements recived</div>
                </div>
            </div>
            
            <div class="achievements-section">
                <h2 class="section-title">Your achievements</h2>
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
            
            <button class="logout-btn" id="logoutBtn">Log out</button>
        </div>
    </div>
    
    <footer>
        <div class="footerWave">¬© 2025 xtteam. All rights reserved.</div>
    </footer>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
        async function loadProfile() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                const response = await fetch('/api/achievements');
                const data = await response.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const unlocked = data.achievements.filter(a => a.unlocked).length;
                document.getElementById('achievementsCount').textContent = unlocked;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const username = document.getElementById('profileUsername');
                username.textContent = data.user?.username || '–ì–æ—Å—Ç—å';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä
                const avatar = document.getElementById('profileAvatar');
                if (data.user?.username) {
                    const firstLetter = data.user.username.charAt(0).toUpperCase();
                    avatar.textContent = firstLetter;
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                displayAchievements(data.achievements);
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                // const gamesVisited = data.achievements.filter(a => 
                //     a.category === 'games' && a.unlocked
                // ).length;
                // document.getElementById('gamesVisited').textContent = gamesVisited;
                
                // –ü—Ä–æ—Å—Ç–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                // const daysActive = Math.floor(unlocked / 2) + 1;
                // document.getElementById('daysActive').textContent = daysActive;
                
            } catch (error) {
                console.error('Load error of account:', error);
                document.getElementById('profileUsername').textContent = 'Load error';
            }
        }
        
        function displayAchievements(achievements) {
            const grid = document.getElementById('achievementsGrid');
            grid.innerHTML = '';
            
            // –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            const icons = {
                'news': 'üì∞',
                'games': 'üéÆ',
                'about': 'üë•',
                'main': 'üè†',
                'contact': 'üìß'
            };
            
            achievements.forEach(achievement => {
                const card = document.createElement('div');
                card.className = 'achievement-card';
                
                const iconClass = achievement.unlocked ? 'unlocked' : 'locked';
                const icon = icons[achievement.category] || 'üèÜ';
                
                card.innerHTML = `
                    <div class="achievement-icon ${iconClass}">
                        ${icon}
                    </div>
                    <div class="achievement-content">
                        <h3 class="achievement-name">${achievement.name}</h3>
                        <p class="achievement-description">${achievement.description}</p>
                        <span class="achievement-category">${achievement.category}</span>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST'
                });
                
                const data = await response.json();
                if (data.success) {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            loadProfile();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            checkAuth();
        });
        
        async function checkAuth() {
            try {
                const response = await fetch('/api/achievements');
                const data = await response.json();
                
                if (!data.user) {
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                window.location.href = '/';
            }
        }
    </script>
</body>
</html>